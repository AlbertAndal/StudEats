{
  "deploy": {
    "build": [
      "mkdir -p storage/framework/cache",
      "mkdir -p storage/framework/sessions", 
      "mkdir -p storage/framework/views",
      "mkdir -p storage/logs",
      "mkdir -p storage/app/public/meals",
      "mkdir -p storage/app/public/profile_photos",
      "mkdir -p storage/app/public/temp",
      "chmod -R 755 storage/"
    ],
    "commands": [
      "php artisan config:clear || echo 'Config clear skipped'",
      "php artisan cache:clear || echo 'Cache clear skipped'", 
      "php artisan route:clear || echo 'Route clear skipped'",
      "rm -rf public/storage || echo 'No existing storage link to remove'",
      "php artisan storage:link --force || echo 'Storage link creation failed'",
      "php artisan session:table --no-interaction || echo 'Session table already exists'",
      "php artisan migrate --force --no-interaction",
      "php artisan db:seed --class=AdminSeeder --force || echo 'Admin seeder skipped'",
      "php artisan db:seed --class=PdriReferenceSeeder --force || echo 'PDRI seeder skipped'",
      "php artisan config:cache",
      "php artisan route:cache"
    ],
    "timeout": 600
  },
  "environment": {
    "SESSION_SECURE_COOKIE": "true", 
    "SESSION_SAME_SITE": "lax",
    "SESSION_PARTITIONED_COOKIE": "false",
    "SESSION_LIFETIME": "240"
  },
  "schedule": {
    "commands": [
      "php artisan queue:work --stop-when-empty --timeout=60"
    ]
  }
}